version: '3.8'
services:
    backend:
        build:
            context: .
            dockerfile: Dockerfile
        ports:
            - "8080:8080"
        depends_on:
            - db
#            - kafka
        environment:
            SPRING_DATASOURCE_URL: jdbc:postgresql://db:5432/postgres
            SPRING_DATASOURCE_USERNAME: ${WISHER_DB_USER}
            SPRING_DATASOURCE_PASSWORD: ${WISHER_DB_PASSWORD}
            JWT_SECRET_KEY: ${JWT_SECRET_KEY}
            S3_ID: ${S3_ID}
            S3_KEY: ${S3_KEY}
            SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092

    db:
        image: postgres:latest
        environment:
            POSTGRES_DB: wisher
            POSTGRES_USER: ${WISHER_DB_USER}
            POSTGRES_PASSWORD: ${WISHER_DB_PASSWORD}
        ports:
            - "5432:5432"
#        volumes:
#            - db_data:/var/lib/postgresql/data

#    kafka:
#        image: wurstmeister/kafka:latest
#        ports:
#            - "9092:9092"
#        environment:
#            KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092
#            KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092
#            KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
#        depends_on:
#            - zookeeper
#
#    zookeeper:
#        image: wurstmeister/zookeeper:latest
#        ports:
#            - "2181:2181"

#volumes:
#    db_data:
